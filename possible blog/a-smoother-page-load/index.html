<!-- Localized -->
<!doctype html>
<!--[if lt IE 9]><html class="ie"><![endif]-->
<!--[if gte IE 9]><!--><html><!--<![endif]-->

	<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		
		<title>A Smoother Page Load &mdash; Joni Korpi  </title>
		
		<meta name="viewport" content="width=device-width; initial-scale=1"/>
		
		<script>try{Typekit.load();}catch(e){};TypekitConfig={kitId:"aew5lfc",scriptTimeout:3000},function(){var a=document.getElementsByTagName("html")[0];a.className+=" wf-loading";var b=setTimeout(function(){a.className=a.className.replace(/(\s|^)wf-loading(\s|$)/g,""),a.className+=" wf-inactive"},TypekitConfig.scriptTimeout),c=document.createElement("script");c.src="//use.typekit.com/"+TypekitConfig.kitId+".js",c.type="text/javascript",c.async="true",c.onload=c.onreadystatechange=function(){var a=this.readyState;if(!a||a=="complete"||a=="loaded"){clearTimeout(b);try{Typekit.load(TypekitConfig)}catch(c){}}};var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d)}()</script>
		
		<link rel="stylesheet" href="../public/assets/main-42113.css"/>
		
		<!--[if lt IE 9]>
			<script src="../public/assets/html5.js"></script>
		<![endif]-->
		
		<link rel="shortcut icon" href="../public/imgs/favicon.ico"/>
		<link rel="apple-touch-icon" sizes="114x114" href="../public/imgs/avatar.jpg"/>
		<link rel="alternate" type="application/rss+xml" href="http://feeds.feedburner.com/jonikorpi">
		
		<meta name="description" content="The blog, CV and portfolio of Joni Korpi, adaptive web designer and creator of Less Framework."/>
	</head>
	
	<body lang="en" id="a-smoother-page-load"   class="vcard ">
	
		<header id="masthead">
			<div class="wrapper">
				<a id="logo" href="../index.html" rel="author">
					<div>
						<figure class="jk-logo frame">
							<img src="../public/imgs/avatar.jpg" alt="Avatar"/>
						</figure>
						<h1 class="fn">Joni Korpi</h1>
						<p class="title">Web&nbsp;Designer</p>
					</div>
				</a>
				<nav>
	<ul>
					<li class="index">
				<a href="../index.html">
					<span class="icon">&#x270E;</span>
					<span>Blog</span>
				</a>
			</li>
		
					<li class="projects">
				<a href="../projects/index.html">
					<span class="icon">&#x2605;</span>				
					<span>Projects</span>
				</a>
			</li>
		
					<li class="about">
				<a href="../about/index.html">
					<span class="icon">?</span>			
					<span>About</span>
				</a>
			</li>
		
	</ul>
</nav>
			</div>
		</header>
		
		<article id="content" class="hentry">
	
	<header>
		<div>
			<h1 class="entry-title">A Smoother Page Load</h1>
			<p>An unexpected opportunity to control how the page loads, using Typekit.</p>
		</div>
	</header>
	
	<div class="wrapper">
		<div class="entry-content">
			<p>I finally have a blog. For the longest time I haven&#8217;t been able to let out the endless rambles about all the little design detail and theories bouncing around in my head. Now I can, and <em>will.</em></p>

<p>I&#8217;m going to start by going over a little trick I discovered when designing this site. When you opened this page, you may noticed that it took a moment longer to load than usual, and that it didn&#8217;t just blink into existence, but <em>faded in.</em></p>

<p>The culprit behind the extra loading time is the <a href="http://blog.typekit.com/2011/05/25/loading-typekit-fonts-asynchronously/">asynchronous Typekit snippet</a>, which loads the web fonts used on this site. Unlike the regular Typekit snippet, the asynchronous one doesn&#8217;t automatically protect you against the Flash of Unstyled Content that can happen if the fonts don&#8217;t load quickly enough, so I had to take care of that manually.</p>

<p>I had to make sure no text elements on the page would show until the fonts have finished loading. To accomplish this, I simply set the opacity of all text on the page to zero using the <code>.wf-loading</code> class provided by the Typekit snippet. I also added a fallback for versions of IE that don&#8217;t support opacity.</p>

<pre><code>.wf-loading h1, 
.wf-loading h2, 
.wf-loading h3, 
.wf-loading p, 
.wf-loading li {
    opacity: 0;
}

.ie.wf-loading h1, 
.ie.wf-loading h2, 
.ie.wf-loading h3, 
.ie.wf-loading p, 
.ie.wf-loading li {
    visibility: hidden; /* Old IE */
}
</code></pre>

<p>While playing around with this, I realised I could also control how the text eventually appears after the fonts have finished loading. By adding a very short CSS transition, I could make it fade in.</p>

<pre><code>h1, h2, h3, p, li {
    opacity: 1;
    visibility: visible; /* Old IE */
    -webkit-transition: opacity 0.24s ease-in-out;
       -moz-transition: opacity 0.24s ease-in-out;
            transition: opacity 0.24s ease-in-out;
}
</code></pre>

<p>This should work in most modern desktop and mobile browsers, including IE9. The fade-in might feel a bit laggy on underpowered computers and mobile devices that don&#8217;t use GPU rendering, but that&#8217;s okay, since it&#8217;ll feel more or less just like a regular blinking-into-existence page load.</p>

<p>There was one downside though: hiding the content made the initial load seem slower. Even though the site is progressively rendering into existence in the background, we can&#8217;t see it, which makes the load time <em>feel</em> longer.</p>

<p>To alleviate this effect, I added a little loading spinner as a GIF image. Since the spinner needed to appear immediately, I embedded it into my stylesheet using a <a href="http://css-tricks.com/5970-data-uris/">data URI</a>. I used Opinionated Geek&#8217;s <a href="http://www.opinionatedgeek.com/dotnet/tools/base64encode/">Base 64 encoder</a> to encode image and embedded it as follows:</p>

<pre><code>.wf-loading #content header {
    background: 
        url(data:image/gif;base64,lots-of-base64…) 
        center center no-repeat
    ;
}
</code></pre>

<figure class="full">
    <img src="../imgs/a-smoother-page-load.png" alt="Loading spinner vs. no loading spinner"/>
    <figcaption>Before and after. The spinner makes it clear something is happening.</figcaption>
</figure>

<p>This should work just fine in all modern browsers, including IE8–9. IE6–7 will simply ignore it, which is fine by me. This is just a minor detail after all.</p>

<p>The resulting effect is pretty interesting, isn&#8217;t it? It doesn&#8217;t feel like a regular HTML page load, but not exactly like an AJAX load either.</p>

<p>This technique could also be applied to images or even the entire page. Theoretically you could even create all sorts of Powerpoint-esque transitions using CSS transforms. It&#8217;s good to practice restraint though, as these effects can be quite performance-intensive. Also, the simpler and faster the transition is, the less likely it is to annoy anyone — good transitions are felt, not noticed. Personally, I think this one turned out pretty good, but I&#8217;d love to hear your opinions about it <a href="http://twitter.com/jonikorpi">on Twitter</a>.</p>

<p><strong>Update on 23 Jul 2011:</strong> The IE fallback was causing the fade-in to feel jerky in Safari, so I split it off into a separate declaration using an <a href="http://paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/">IE conditional class</a>. It will probably not work in IE6, but will in IE7–8.</p>

<p><strong>Update on 2 Aug 2011:</strong> The fade-in on this site is currently disabled while I&#8217;m investigating whether it has something to do with the mysterious plummeting of this site&#8217;s Google ranking.</p>

<p><strong>Update on 10 Aug 2011:</strong> The fade-in is back in action. It doesn&#8217;t seem to have caused my ranking problems.</p>

		</div>
		
		<footer>
			<dl class="byline author vcard">
				<div id="morePosts">
					<dt>&#x21A9; Archive</dt>
					<dd><a href="../index.html">More posts</a></dd>
				</div>
				<div id="published">
					<dt>Posted on</dt>
					<dd><time datetime="2011-08-10T22:49:27+10:00" pubdate class="updated">17 Jul 2011</time></dd>
				</div>
				<div id="readingTime">
					<dt>Reading time</dt>
					<dd>2&frac12; minutes</dd>
				</div>
				<div id="nextPost">
					<dt>Next post &rarr;</dt>
					<dd>
						<a href="../leaving-old-IE-behind/index.html">Leaving Old Internet Explorer Behind</a> 
					</dd>
				</div>
			</dl>
		</footer>
	</div>
	
		</article>
		
		<footer id="colophon">
			<div class="wrapper">
				<section class="links contact">
					<h2>Contact Me</h2>
					<ul>
						<li>
							<a href="http://twitter.com/jonikorpi">
								Tweet @me
								<span>for quick replies</span>
							</a>
						</li>
						<li id="email">
							<a href="mailto:&#x6d;&#x65;&#x40;&#x6a;&#x6f;&#x6e;&#x69;&#107;&#111;&#114;&#112;&#105;&#46;&#99;&#111;&#109;">
								Email me
								<span>for slow replies</span>
							</a>
						</li>
					</ul>
				</section>
				<section class="links follow">
					<h2>Follow Me</h2>
					<ul>
						<li>
							<a href="http://twitter.com/jonikorpi">
								Follow my tweets
								<span>@jonikorpi</span>
							</a>
						</li>
						<li>
							<a href="http://dribbble.com/jonikorpi">
								Follow my work
								<span>on Dribbble</span>
							</a>
						</li>
						<li id="followBlog">
							<a href="http://feeds.feedburner.com/jonikorpi">
								Follow via RSS 
								<span>for new blog posts</span>
							</a>
						</li>
					</ul>
				</section>
				<section id="copyright">
					<p>
						Code &amp; content by Joni Korpi. <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons Attribution">Some rights reserved</a>; please attribute properly and link back to this site.
						The typefaces used are 
						<a href="http://typekit.com/fonts/lft-etica-web">LFT Etica</a> and 
						<a href="http://typekit.com/fonts/pt-sans">PT&nbsp;Sans</a>, 
						via&nbsp;<a href="http://typekit.com/">Typekit</a>. 
					</p>
				</section>
			</div>
		</footer>
		
		<script src="../public/assets/main.js"></script>
		
	</body>
	
</html>
<!-- Stacey(2.3.0). -->